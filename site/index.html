<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebGL</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="icon" type="image/png" href="img/tab-icon.png?v=2" />
    <link rel="stylesheet" href="style.css" />

    <script type="text/javascript" src="webgl-debug.js"></script>
    <script type="text/javascript" src="astro.js"></script>
    <script type="text/javascript" src="scene.js"></script>

    <script type="text/javascript">
        let onBodyLoad = function () {
            MouseTracker.new ("render-canvas", OnReady.new (null, function (deltaPosition) {
                draw (deltaPosition);
            }));
            Render.new ("render-canvas");

            let loader = Loader.new ({ onFinishedAll: OnReady.new (null, function (x) {
                Program.new ("basic", { vertexShader: "vertex-basic", fragmentShader: "fragment-basic" });
                Program.new ("overlay", { vertexShader: "vertex-basic", fragmentShader: "fragment-overlay" });
                Program.new ("texture", { vertexShader: "vertex-basic", fragmentShader: "fragment-texture" });
                Program.new ("earth", { vertexShader: "vertex-basic", fragmentShader: "fragment-earth" });
                Program.new ("clouds", { vertexShader: "vertex-basic", fragmentShader: "fragment-clouds" });
                Program.new ("atmosphere", { vertexShader: "vertex-basic", fragmentShader: "fragment-atmosphere" });

                buildScene ();

                // update the textures....
                setTimeout (function () {
                    let loader2 = Loader.new ({ onFinishedItem: OnReady.new (null, function (x) {
                        draw ([0, 0]);
                    })});
                    loader2.addItem (Texture, "clouds", { url: "https://raw.githubusercontent.com/apollo-ng/cloudmap/master/global.jpg", generateMipMap: true });
                    loader2.addItem (Texture, "earth-day", { url: "textures/earth-day.png", generateMipMap: true });
                    loader2.addItem (Texture, "earth-night", { url: "textures/earth-night.png", generateMipMap: true });
                    loader.addItem (Texture, "earth-specular-map", { url:"textures/earth-specular-map.png", generateMipMap: true });
                    loader2.addItem (Texture, "starfield", { url: "textures/starfield.png" });
                    loader2.addItem (Texture, "constellations", { url: "textures/constellations.png" });
                    //loader2.addItem (Texture, "moon", { url: "textures/moon.png", generateMipMap: true });
                    loader2.go ();
                }, 1000);
            })});

            // XXX could I automatically scan for all these things?
            loader.addItem (Shader, "vertex-basic", { url:"shaders/vertex-basic.glsl", type: context.VERTEX_SHADER });
            loader.addItem (Shader, "fragment-basic", { url:"shaders/fragment-basic.glsl", type: context.FRAGMENT_SHADER });
            loader.addItem (Shader, "fragment-overlay", { url: "shaders/fragment-overlay.glsl", type: context.FRAGMENT_SHADER });
            loader.addItem (Shader, "fragment-texture", { url: "shaders/fragment-texture.glsl", type: context.FRAGMENT_SHADER });
            loader.addItem (Shader, "fragment-earth", { url: "shaders/fragment-earth.glsl", type: context.FRAGMENT_SHADER });
            loader.addItem (Shader, "fragment-clouds", { url: "shaders/fragment-clouds.glsl", type: context.FRAGMENT_SHADER });
            loader.addItem (Shader, "fragment-atmosphere", { url: "shaders/fragment-atmosphere.glsl", type: context.FRAGMENT_SHADER });

            loader.addItem (Texture, "grid", { url:"textures-test/grid.png", generateMipMap: true });
            //loader.addItem (Texture, "tissot", { url:"textures-test/tissot.png", generateMipMap: true });
            //loader.addItem (Texture, "earth-plate-carree", { url:"textures-test/earth-plate-carree.png", generateMipMap: true });

            loader.addItem (Texture, "earth-day", { url:"textures-lores/earth-day.png", generateMipMap: true });
            loader.addItem (Texture, "earth-night", { url:"textures-lores/earth-night.png", generateMipMap: true });
            loader.addItem (Texture, "earth-specular-map", { url:"textures-lores/earth-specular-map.png", generateMipMap: true });
            loader.addItem (Texture, "clouds", { url: "textures-lores/clouds.png", generateMipMap: true });
            loader.addItem (Texture, "starfield", { url: "textures-lores/starfield.png" });
            loader.addItem (Texture, "constellations", { url: "textures-lores/constellations.png" });
            //loader.addItem (Texture, "moon", { url: "textures-lores/moon.png", generateMipMap: true });
            loader.go ();
        };
    </script>
</head>
<body onload="onBodyLoad ();">
<div id="title"><span style="font-family:sans-serif;font-size:24px;color:white;">WebGL</span></div>
<div style="margin-left:auto;margin-right:auto;width:640px;height:480px;">
    <canvas id="render-canvas" style="border:none;margin:0;width:100%;height:100%;" width="640" height="480" tabindex="0"></canvas>
</div>
<div id="footer">
    <a href="../docs" style="float:left;text-decoration:none;font-family:sans-serif;font-size:14px;color:white;">docs</a>
    <a href="https://github.com/brettonw/WebGL" style="float:right;text-decoration:none;font-family:sans-serif;font-size:14px;color:white;">... on GitHub</a>
</div>
<div style="display:block;clear:both;margin-top:50px;font-family:sans-serif;font-size:12px;color:cornflowerblue;">
    Credits: <ul>
    <li><a style="color:lightskyblue;" href="https://svs.gsfc.nasa.gov/3895">star and constellations maps</a>:
    NASA/Goddard Space Flight Center Scientific Visualization Studio. Constellation figures based
    on those developed for the IAU by Alan MacRobert of Sky and Telescope magazine (Roger Sinnott
    and Rick Fienberg).</li>
    <li><a style="color:lightskyblue;" href="http://laps.noaa.gov/albers/sos/sos.html">moon map</a>: By Jens Meyer</li>
    <li><a style="color:lightskyblue;" href="http://laps.noaa.gov/albers/sos/sos.html">earth daytime map</a>: Blue Marble</li>
    </ul>
</div>
</body>
</html>
